<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- Created by htmlize-1.56 in css mode. -->
<html>
  <head>
    <title>2048.beads</title>
    <style type="text/css">
    <!--
      body {
        color: #D8DEE9;
        background-color: #2E3440;
      }
      .comment {
        /* font-lock-comment-face */
        color: #616e88;
      }
      .constant {
        /* font-lock-constant-face */
        color: #81A1C1;
      }
      .custom {
        /* (:background "#BBADA0") */
        background-color: #BBADA0;
      }
      .custom-1 {
        /* (:background "#edc22e") */
        background-color: #edc22e;
      }
      .custom-10 {
        /* (:background "#f2b179") */
        background-color: #f2b179;
      }
      .custom-11 {
        /* (:background "#ede0c8") */
        background-color: #ede0c8;
      }
      .custom-12 {
        /* (:background "#eee4da") */
        background-color: #eee4da;
      }
      .custom-13 {
        /* (:background "#cdc1b4") */
        background-color: #cdc1b4;
      }
      .custom-14 {
        /* (:foreground "black") */
        color: #000000;
      }
      .custom-2 {
        /* (:background "#edc53f") */
        background-color: #edc53f;
      }
      .custom-3 {
        /* (:background "#edc850") */
        background-color: #edc850;
      }
      .custom-4 {
        /* (:background "#edcc61") */
        background-color: #edcc61;
      }
      .custom-5 {
        /* (:background "#edcf72") */
        background-color: #edcf72;
      }
      .custom-6 {
        /* (:background "#f65e3b") */
        background-color: #f65e3b;
      }
      .custom-7 {
        /* (:foreground "white") */
        color: #ffffff;
      }
      .custom-8 {
        /* (:background "#f67c5f") */
        background-color: #f67c5f;
      }
      .custom-9 {
        /* (:background "#f59563") */
        background-color: #f59563;
      }
      .function-name {
        /* font-lock-function-name-face */
        color: #88C0D0;
      }
      .highlight-indent-guides-even {
        /* highlight-indent-guides-even-face */
        background-color: #43694c345dc9;
      }
      .highlight-indent-guides-odd {
        /* highlight-indent-guides-odd-face */
        background-color: #38b4401a4ee4;
      }
      .string {
        /* font-lock-string-face */
        color: #A3BE8C;
      }
      .type {
        /* font-lock-type-face */
        color: #8FBCBB;
      }
      .variable-name {
        /* font-lock-variable-name-face */
        color: #D8DEE9;
      }

      a {
        color: inherit;
        background-color: inherit;
        font: inherit;
        text-decoration: inherit;
      }
      a:hover {
        text-decoration: underline;
      }
    -->
    </style>
  </head>
  <body>
    <pre>
beads <span class="constant">1</span> program Game2048

<span class="comment">// -------------------------------------------</span>
<span class="function-name">const</span>
<span class="highlight-indent-guides-even">    </span>gap = <span class="constant">4</span>
<span class="highlight-indent-guides-even">    </span>colors = [<span class="custom-13"><span class="custom-14">#cdc1b4</span></span> <span class="custom-12"><span class="custom-14">#eee4da</span></span> <span class="custom-11"><span class="custom-14">#ede0c8</span></span> <span class="custom-10"><span class="custom-14">#f2b179</span></span> <span class="custom-9"><span class="custom-14">#f59563</span></span> <span class="custom-8"><span class="custom-14">#f67c5f</span></span> <span class="custom-6"><span class="custom-7">#f65e3b</span></span> <span class="custom-5"><span class="custom-14">#edcf72</span></span> <span class="custom-4"><span class="custom-14">#edcc61</span></span> <span class="custom-3"><span class="custom-14">#edc850</span></span> <span class="custom-2"><span class="custom-14">#edc53f</span></span> <span class="custom-1"><span class="custom-14">#edc22e</span></span> <span class="custom-1"><span class="custom-14">#edc22e</span></span>]

<span class="function-name">record</span> game  
<span class="highlight-indent-guides-even">    </span>won : yesno
<span class="highlight-indent-guides-even">    </span>noMoreMoves : yesno

<span class="comment">// -------------------------------------------</span>
<span class="function-name">var</span>
<span class="highlight-indent-guides-even">    </span>board : array of num
<span class="highlight-indent-guides-even">    </span>g : game
<span class="highlight-indent-guides-even">    </span>blanks
<span class="highlight-indent-guides-even">    </span>moved : yesno
<span class="highlight-indent-guides-even">    </span>color : color

<span class="comment">// -------------------------------------------</span>
<span class="function-name">calc</span> addTile
<span class="highlight-indent-guides-even">    </span><span class="function-name">var</span>
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>v = <span class="function-name">if</span> random() &gt; <span class="constant">0.9</span> <span class="function-name">then</span> <span class="constant">4</span> <span class="function-name">else</span> <span class="constant">2</span>
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>p = random_int(<span class="constant">1</span>,blanks)
<span class="highlight-indent-guides-even">    </span>dec blanks
<span class="highlight-indent-guides-even">    </span><span class="function-name">loop</span> <span class="variable-name">reps:</span><span class="constant">16</span> <span class="variable-name">count:</span>ix
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="function-name">if</span> is_numeric(board[ix])
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="function-name">continue</span>
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>dec p
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="function-name">if</span> p == <span class="constant">0</span>
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span>board[ix]=v
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span>exit

<span class="comment">// -------------------------------------------</span>
<span class="function-name">calc</span> canMove
<span class="highlight-indent-guides-even">    </span><span class="function-name">var</span> p = <span class="constant">1</span>
<span class="highlight-indent-guides-even">    </span><span class="type">g.</span>noMoreMoves = N
<span class="highlight-indent-guides-even">    </span><span class="function-name">if</span> blanks &gt; <span class="constant">0</span>
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="function-name">return</span>
<span class="highlight-indent-guides-even">    </span><span class="function-name">loop</span> <span class="variable-name">reps:</span><span class="constant">4</span>
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="function-name">loop</span> <span class="variable-name">reps:</span><span class="constant">3</span>
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="function-name">if</span> board[p] == board[p+<span class="constant">1</span>] or board[p] == board[p+<span class="constant">4</span>] 
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="function-name">return</span>
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span>inc p
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>inc p   
<span class="highlight-indent-guides-even">    </span><span class="type">g.</span>noMoreMoves = Y

<span class="comment">// -------------------------------------------</span>
<span class="function-name">calc</span> init_board
<span class="highlight-indent-guides-even">    </span>board &lt;=== []
<span class="highlight-indent-guides-even">    </span>blanks = <span class="constant">16</span>
<span class="highlight-indent-guides-even">    </span>addTile
<span class="highlight-indent-guides-even">    </span>addTile
<span class="highlight-indent-guides-even">    </span><span class="type">g.</span>won = N
<span class="highlight-indent-guides-even">    </span><span class="type">g.</span>noMoreMoves = N
    
<span class="comment">// -------------------------------------------</span>
<span class="function-name">calc</span> trymove(
<span class="highlight-indent-guides-even">    </span>p1
<span class="highlight-indent-guides-even">    </span>ix
<span class="highlight-indent-guides-even">    </span>iy
<span class="highlight-indent-guides-even">    </span>)
<span class="highlight-indent-guides-even">    </span><span class="function-name">var</span>
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>x1
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>x2      
<span class="highlight-indent-guides-even">    </span><span class="function-name">loop</span> <span class="variable-name">reps:</span><span class="constant">4</span>
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>x1=p1
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>x2=p1+ix
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>p1=p1+iy    
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="function-name">loop</span> <span class="variable-name">reps:</span><span class="constant">3</span>
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="function-name">if</span> board[x2] == U
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>x2 = x2 + ix
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="function-name">elif</span> board[x1] == U
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>board[x1] = board[x2]
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>board[x2] = U
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>x2 = x2 + ix
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>moved = Y
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="function-name">elif</span> board[x1] == board[x2]
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>board[x1] = board[x1] * <span class="constant">2</span>
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="function-name">if</span> board[x1] == <span class="constant">2048</span>
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="type">g.</span>won = Y
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>inc blanks
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>moved = Y
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>board[x2] = U
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>x1 = x1 + ix
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>x2 = x2 + ix
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="function-name">else</span> 
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>x1 = x1 + ix
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="function-name">if</span> board[x1] == U
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span>board[x1] = board[x2]
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span>board[x2] = U
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span>moved = Y
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>x2 = x2 + ix

<span class="comment">// -------------------------------------------</span>
<span class="function-name">grid</span> d_board
<span class="highlight-indent-guides-even">    </span><span class="function-name">horz</span> slice
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="function-name">skip</span> gap al
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="function-name">loop</span> <span class="variable-name">reps:</span><span class="constant">4</span>
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="function-name">add</span> <span class="constant">40</span> al
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="function-name">skip</span> gap al
<span class="highlight-indent-guides-even">    </span><span class="function-name">vert</span> slice
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="function-name">skip</span> gap al
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="function-name">loop</span> <span class="variable-name">reps:</span><span class="constant">4</span>
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="function-name">add</span> <span class="constant">40</span> al
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="function-name">skip</span> gap al
<span class="highlight-indent-guides-even">    </span><span class="function-name">under</span>
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>draw_rect(<span class="variable-name">fill:</span><span class="custom"><span class="custom-14">#BBADA0</span></span>)
<span class="highlight-indent-guides-even">    </span><span class="function-name">cell</span>    
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="function-name">var</span> 
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span>v
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span>ix = round(lg(board[<span class="type">b.</span>cell_seq],<span class="variable-name">base:</span><span class="constant">2</span>))
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>ix = <span class="function-name">if</span> ix&gt;<span class="constant">12</span> <span class="function-name">then</span> <span class="constant">13</span> <span class="function-name">else</span> <span class="function-name">if</span> ix&gt;<span class="constant">0</span> <span class="function-name">then</span> ix+<span class="constant">1</span> <span class="function-name">else</span> <span class="constant">1</span>
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>color = colors[ix]
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>v = <span class="function-name">if</span> is_numeric(board[<span class="type">b.</span>cell_seq]) <span class="function-name">then</span> board[<span class="type">b.</span>cell_seq] <span class="function-name">else</span> <span class="string">""</span>
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>draw_rect(<span class="variable-name">fill:</span>color, <span class="variable-name">thick:</span><span class="constant">0</span> pt)
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>draw_str(v, <span class="variable-name">size:</span><span class="constant">0.5</span>, <span class="variable-name">bold:</span>Y)
<span class="highlight-indent-guides-even">    </span>over
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="function-name">if</span> <span class="type">g.</span>won or <span class="type">g.</span>noMoreMoves
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="function-name">var</span> msg : str
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="function-name">if</span> <span class="type">g.</span>won
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>color = DODGER_BLUE 
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>msg = <span class="string">"Congratulations!\nYou made it.\n2048"</span>
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="function-name">if</span> <span class="type">g.</span>noMoreMoves
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>color=RED   
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>msg=<span class="string">"Game over."</span>
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span>draw_rect(<span class="variable-name">fill:</span>color, <span class="variable-name">thick:</span><span class="constant">0</span> pt, <span class="variable-name">opacity:</span><span class="constant">0.8</span>)  
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span>draw_str(msg, <span class="variable-name">size:</span><span class="constant">0.5</span>, <span class="variable-name">bold:</span>Y,<span class="function-name">vert</span>:<span class="constant">0.1</span>,<span class="variable-name">color:</span>YELLOW)
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="highlight-indent-guides-even">    </span>draw_str(<span class="string">"Press any key."</span>, <span class="variable-name">bold:</span>Y,<span class="function-name">vert</span>:<span class="constant">0.9</span>,<span class="variable-name">color:</span>YELLOW)
        
<span class="comment">// -------------------------------------------</span>
<span class="function-name">track</span> EV_KEYBOARD
<span class="highlight-indent-guides-even">    </span><span class="function-name">if</span> <span class="type">g.</span>won
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="type">g.</span>won = N
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="function-name">return</span> Y
<span class="highlight-indent-guides-even">    </span><span class="function-name">if</span> <span class="type">g.</span>noMoreMoves
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>init_board
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span><span class="function-name">return</span> Y
<span class="highlight-indent-guides-even">    </span>moved = N
<span class="highlight-indent-guides-even">    </span><span class="function-name">case</span> <span class="type">e.</span>keycode
<span class="highlight-indent-guides-even">    </span>| KEYCODE_UP
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>trymove(<span class="constant">1</span>, <span class="constant">4</span>, <span class="constant">1</span>)
<span class="highlight-indent-guides-even">    </span>| KEYCODE_LEFT
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>trymove(<span class="constant">1</span>, <span class="constant">1</span>, <span class="constant">4</span>)
<span class="highlight-indent-guides-even">    </span>| KEYCODE_DOWN
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>trymove(<span class="constant">13</span>, -<span class="constant">4</span>, <span class="constant">1</span>)
<span class="highlight-indent-guides-even">    </span>| KEYCODE_RIGHT
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>trymove(<span class="constant">4</span>, -<span class="constant">1</span>, <span class="constant">4</span>)
<span class="highlight-indent-guides-even">    </span><span class="function-name">if</span> moved
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>moved = N
<span class="highlight-indent-guides-even">    </span><span class="highlight-indent-guides-odd">    </span>addTile
<span class="highlight-indent-guides-even">    </span>canMove
    
<span class="comment">// -------------------------------------------</span>
<span class="function-name">calc</span> main_init
<span class="highlight-indent-guides-even">    </span>init_board
     
<span class="comment">// -------------------------------------------</span>
<span class="function-name">draw</span> main_draw
<span class="highlight-indent-guides-even">    </span>layer <span class="variable-name">area:</span>solve_rect(<span class="variable-name">basis:</span><span class="type">b.</span>box, <span class="variable-name">pin:</span>MID_CENTER, <span class="variable-name">aspect:</span><span class="constant">1</span>) d_board        
</pre>
  </body>
</html>
